<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>百度练习</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		.top{
			margin-bottom: 50px;
		}
		.right{
			float: right;
			margin-right: 600px;
		}
		form{
			float: left;
			margin-left: 280px;
			width: 720px;
			height: 600px;
			/*border: 1px solid #000;*/
		}
		.p{
			position: relative;
			margin-bottom: 20px;
		}
		label{
			font-size: 16px;
			color: #666;
			width: 65px;
			font-weight: bolder;
			float: left;
			margin: 10px;
			text-align: right;
			/*line-height: 40px;*/
			vertical-align: middle;
		}
		input{
			width: 350px;
			height: 40px;
			padding-left: 10px;
			border: 1px solid #ddd;
			cursor: pointer;
			/*float: left;*/
			margin-right:15px; 
		}
		input:focus{
			 border-color: #488ee7;
             outline: 0;
		}
		.input-err{
			border-color: red;
		}
		 .p .err{
			background: url(images/reg_icons.png)  no-repeat -79px -23px;
			padding-left: 20px;
			color: #fc4343;
		}
		.ok{
			background: url(images/reg_icons.png)  no-repeat -79px 0px;
			width: 16px;
			height: 16px;
			display: inline-block;
		}
		.cancel{
			width: 14px;
			height: 14px;
			position: absolute;
			background: url(images/reg_icons.png)  no-repeat -33px -26px;
			top: 15px;
			left: 420px;
			cursor: pointer;
		}
		.cancel:hover{
			background: url(images/reg_icons.png)  no-repeat -49px -26px;
		}
		.p span:nth-of-type(2){
			font-size: 12px;
			color: #aaa;
			display: block;
			position: absolute;
			top: -3px;
			left: 454px;
			margin-top: 10px;
		}
		.fade{
			display: none;
		}
		.verify input{
			width: 190px;
		}
		.verify .cancel{
			left: 260px
		}
		.need{
			height: 40px;
			width: 140px;
			position: absolute;
			left: 305px;
			top: 0px;
			border: 1px solid #ddd;
			background-color: #f7f7f7;
			text-align: center;
			line-height: 42px;
			color: #666;
			cursor: pointer;
		}
		.agree input{
			width: 14px;
			height: 14px;
			margin-left: 80px;
			vertical-align: middle;
			float: left;
		}
		 .agree{
			color: #aaa;
			font-size: 12px;
			float: none;
		}
		.agree span{
			float: none;
		}
		.agree a{
			color: #1b66c7;
		}
		.login{
			width: 350px;
			height: 50px;
			background-color: #3f89ec;
			color: white;
			font-weight: bolder;
			margin-left: 80px;
			text-align: center;
			line-height: 52px;
			cursor: pointer;
			font-size: 20px;
		}
		.p .msg{
			display: none;
		}
		.list{
			border: 1px solid #ddd;
			/*background-color: red;*/
			position: absolute;
			top: 0px;
			left: 460px;
			font-size: 12px;
			color: #bbb;
			padding: 10px;
			width: 200px;
		}
		.list li{
			padding-left: 18px;
			background: url(images/reg_icons.png) no-repeat -86px -112px;
			
		}
		.row{
			border-left: 1px solid #ddd;
			border-bottom: 1px solid #ddd;
			width: 10px;
			height: 10px;
			position: absolute;
			top:10px;
			left: -8px;
			transform: rotateZ(45deg);
			z-index: 10;
			background: #f9f9f9;;
		}
		 .list .row-ok{
			background: url(images/reg_icons.png) no-repeat -86px -135px;
		}
		 .list .row-err{
			background: url(images/reg_icons.png) no-repeat -86px -151px;
		}
	</style>
</head>
<body>
	<div class="top">
		<img src="images/t.png" alt="">
	</div>
	<div class="mian">
		<div class="left">
			<form action="https://www.kuazhu.com" target="_blank">
				<div class="username p">
					<label for="username">用户名</label>
					<input type="text" name="username" placeholder="请设置用户名" autocomplete="off">
					<span class="cancel" style="display: none;"></span>
					<span class="msg" ></span>
				</div>
				<div class="phone p">
					<label for="phone">手机号</label>
					<input type="text" name="phone" placeholder="可用于登陆和找回密码" autocomplete="off">
					<span class="cancel" style="display: none;"></span>
					<span class="msg" ></span>
				</div>
				<div class="password p">
					<label for="password">密码</label>
					<input type="password" name="password" placeholder="请设置登陆密码" autocomplete="off">
					<span class="cancel" style="display: none;"></span>
					<span class="msg" ></span>
					<div class="list" 	style="display: none;">
						<ul>
							<li >不允许有空格</li>
							<li >长度为8~14个字符</li>
							<li>支持数字,大小写字母和标点符号</li>
						</ul>
						<span class="row"></span>
					</div>
					<span class="msg" ></span>
				</div>
				<div class="verify p">
					<label for="verify">验证码</label>
					<input type="text" name="verify" placeholder="请输入验证码" autocomplete="off">
					<span class="cancel" style="display: none;"></span>
					<div class="need">获取验证码</div>
					<span class="msg"></span>
				</div>
				<div class="agree p">
					<input type="checkbox" id="agree">
					<span>阅读并接受《<a href="">百度用户协议</a>》及《<a href="">百度隐私权保护声明</a>》</span>
					<span class="msg">请勾选协议</span>
				</div>
				<div class="login">注册</div>
			</form>
			
		</div>
		<div class="right">
			<img src="images/l.png" alt="">
		</div>
	</div>
</body>
<script>
	//通用函数
	function getLen(str){
		return str.replace(/[\u4e00-\u9fa5]/g,"aa").length
	}
	function setErr(oMsg,oInput,aMsg){
		oMsg.className="err";
		oMsg.innerHTML=aMsg;
		oInput.className="input-err"
	}
	function setOk(oMsg,oInput){
		oMsg.className="ok";
		oMsg.innerHTML="";
		oInput.className=""
	}
	//1.罗列属性
	var oForm=document.forms[0];
	var aMsg=document.querySelectorAll('.msg');
	var aCancel=document.querySelectorAll('.cancel');
	var oUsername=oForm.username;
	var oPhone=oForm.phone;
	var oPassword=oForm.password;
	var oList=document.getElementsByClassName('list');
	var oListLi=oList[0].querySelectorAll("li");
	var oBtn=document.querySelector('.need');
	var oLogin=document.querySelector('.login')
	var  oVerify=oForm.verify;
	var oAgree=document.querySelector('#agree')
	var bPhone=true;
	var oUsernameOk=false;
	var oPhoneOk=false;
	var oPasswordOk=false;
	var oVerifyOk=false;
	var oAgreeOk=false;
	//2初始化页面
	oUsername.focus();
	aMsg[0].innerHTML="设置后不可更改<br>中英文均可，最长14个字符";
	aMsg[0].className=""
	//3 利用委托事件处理显示隐藏取消按钮
	oForm.oninput=function(ev){
		var oInput=ev.target;
		var len=oInput.value.length;
		var oCancel=oInput.nextElementSibling;
		if(len>0){
			oCancel.style.display="block"
		}else{
			oCancel.style.display="none"
		}
	}
	//4利用委托实际那处理取消按钮
	oForm.onclick=function(ev){
		var oCancel=ev.target;
		var oInput=oCancel.previousElementSibling;
		if(oInput){
			if(oInput.name=="username"||oInput.name=="phone"||oInput.name=="password"||oInput.name=="verify"){
				oInput.value="";
				oInput.focus();
				oCancel.style.display="none";
			}
		}
			
	}
	//5绑定用户名事件
	checkUsername();
	function checkUsername(){
		oUsername.onfocus=function(){
			aMsg[0].innerHTML="设置后不可更改<br>中英文均可，最长14个字符";
			aMsg[0].className=""
		}
		oUsername.onblur=function(){
		//罗列元素
			var sVal=oUsername.value;		
			var reg1=/^\s+$/;
			var reg2=/^\d+$/;
			var reg3=/[^0-9a-z_\u4e00-\u9fa5]/i;
			if(sVal==""){
				aMsg[0].innerHTML="";
				oUsername.className = "";
			}else if(reg1.test(sVal)){
				// aMsg[0].className="err"
				// aMsg[0].innerHTML="用户名不能为空格";
				// oUsername.className="input-err"
				setErr(aMsg[0],oUsername,"用户名不能为空格")
			}else if(getLen(sVal)>14){
				// aMsg[0].className="err"
				// aMsg[0].innerHTML="用户名不能超过14个字符";
				// oUsername.className="input-err"
				setErr(aMsg[0],oUsername,"用户名不能超过14个字符")
			}else if(reg2.test(sVal)||reg3.test(sVal)){
				// aMsg[0].className="err"
				// aMsg[0].innerHTML="用户名不能全为数字	且不能包含非法字符";
				// oUsername.className="input-err"
				setErr(aMsg[0],oUsername,"用户名不能全为数字	且不能包含非法字符")
			}
			else{
				// aMsg[0].className="ok"
				// aMsg[0].innerHTML="";
				// oUsername.className=""
				setOk(aMsg[0],oUsername);
				oUsernameOk=true;
			}
		}
	}
	//6绑定手机号事件
	checkPhone();
	function checkPhone(){
		oPhone.onfocus=function(){
			aMsg[1].innerHTML="请输入中国大陆手机号，其他用户不可见";
			aMsg[1].className=""
		}
		oPhone.onblur=function(){
		//罗列元素
			var sVal=oPhone.value;	
			var reg1=/^\s+$/;	
			var reg2=/^1[35789]\d{9}$/;
			if(sVal==""){
				aMsg[1].innerHTML="";
				oPhone.className = "";
			}else if(reg1.test(sVal)){
				setErr(aMsg[1],oPhone,"手机号不能为空格")
				bPhone=false;
			}
			else if(!reg2.test(sVal)){
				setErr(aMsg[1],oPhone,"手机号格式不正确");
				bPhone=false;
			}
			else{
				setOk(aMsg[1],oPhone);
				bPhone=true;
				oPhoneOk=true;
			}
		}
		oPhone.onkeydown = function(ev){
	      if((ev.keyCode <96 || ev.keyCode >105 || oPhone.value.length > 10)&&(ev.keyCode<47||ev.keyCode>58|| oPhone.value.length > 10) && ev.keyCode != 8 && ev.keyCode != 37 && ev.keyCode != 39){
                return false;
            }
	          
	           }
         	}	
	
	//7事实验证密码
	checkPwd();
	function checkPwd(){
		var  pk1=true;
		var  pk2=true;
		var  pk3=true;
		oPassword.onfocus=function(){
			oList[0].style.display="block"
			aMsg[2].style.display="msg";
		}
		oPassword.oninput=function(){
			var sVal=oPassword.value;
			var reg1=/\s/g;
			var reg2=/^.{8,14}$/;
			var reg3=/[^0-9a-z\.\?\,]/i;
			//空格
			if(reg1.test(sVal)){
				oListLi[0].className="row-err";
				pk1=false;
			}else{
				oListLi[0].className="row-ok";	
				pk1=true;				
			}
			//长度为8~14个字符
			if(!reg2.test(sVal)){
				oListLi[1].className="row-err";
				pk2=false;
			}else{
				oListLi[1].className="row-ok";
				pk2=true;	
			}
			//支持数字,大小写字母和标点符号
			if(reg3.test(sVal)){
				oListLi[2].className="row-err";
				pk3=false;
			}else{
				oListLi[2].className="row-ok";
				pk3=true;	
			}
		}
			//取消按钮
			aCancel[2].onclick=function(){
				//恢复默认状态
				aMsg[2].style.display = 'none';
				oListLi[0].className="";
				oListLi[1].className="";
				oListLi[2].className="";
			}
			//失去焦点验证
			oPassword.onblur=function(){
				var sVal=oPassword.value;
				if(sVal==""){//只能用if和if else把这些条件联系起来
					oList[0].style.display="none";
					oPassword.className=" ";
					aMsg[2].style.display='none';
				}
				else if(pk1&&pk2&&pk3){
					oList[0].style.display="none";
					setOk(aMsg[2],oPassword);
					oPasswordOk=true;
				}else{
					oList[0].style.display="none";
					setErr(aMsg[2],oPassword,"密码格式不正确");
					console.log('yes')
				}
			}
	}
	//8验证码验证
	checkVerify();
	function checkVerify(){
		//点击获取验证码
		oBtn.onclick=function(){
			if(oPhone.value==""){
				setErr(aMsg[1],oPhone,"请输入手机号");
				return false;
			}//手机号验证不通过
			if(!bPhone){
				return false;
			}
			alert("验证码获取中");
		}
		//限制验证码长度
		oVerify.onkeydown=function(ev){
			if(oVerify.value.length>5&&ev.keyCode!=8&&ev.keyCode!=37&&ev.keyCode!=39){
				return false;
			}
		}//失去焦点验证
		oVerify.onblur=function(){
			var sVal=oVerify.value;
			var reg=/\s/g;
			if(sVal==""){
			}else if(reg.test(sVal)){
				setErr(aMsg[4],oVerify,"验证码不能有空格")
			}else if(sVal.length<6){
				setErr(aMsg[4],oVerify,"验证码为六位")
			}else{
				setOk(aMsg[4],oVerify);
				oVerifyOk=true;
			}
		}
	}
	//9注册
	toLogin();
	function toLogin(){
		oLogin.onclick=function(){
			//提示未输入
			if(oUsername.value==""){
			setErr(aMsg[0],oUsername,"请创建用户名");
			}
			if(oPhone.value==""){
			setErr(aMsg[1],oPhone,"请输入手机号");
			}
			if(oPassword.value==""){
			setErr(aMsg[2],oPassword,"请输入密码");
			}if(oVerify.value==""){
				setErr(aMsg[4],oVerify,"请输入验证码");
			}
			if(oVerify.value==""){
			setErr(aMsg[4],oVerify,"请输入验证码");
			}
			// console.log(oAgree.checked)
			//要勾选单选框
			if(oAgree.checked){
				aMsg[5].style.display="none";
				oAgreeOk=true;
			}else{
				aMsg[5].style.display="inline-block";
				aMsg[5].style.color="red";
			}

			if(oUsernameOk&&oPhoneOk&&oPasswordOk&&oVerifyOk&&oAgreeOk){
					oForm.submit();
			}
	}
}
</script>
</html>